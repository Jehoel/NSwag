{% if response.HasType -%}
{%     if response.IsFile -%}
{%         if response.IsSuccess -%}
var responseStream_ = response_.Content == null ? System.IO.Stream.Null : await response_.Content.ReadAsStreamAsync().ConfigureAwait(false);
var fileResponse_ = new FileResponse((Int32)response_.StatusCode, headers_, responseStream_, {% if InjectHttpClient %}null{% else %}client_{% endif %}, response_); 
client_ = null; response_ = null; // response and client are disposed by FileResponse
return fileResponse_;
{%         else -%}
({{ response.Type }} responseObject, String responseText) = await this.ReadObjectResponseAsync<{{ response.Type }}>( response_, headers_ ).ConfigureAwait(false);
throw new ResponseDeserializationException("{{ response.ExceptionDescription }}", reason: ClientExceptionReason.ExpectedError, (Int32)response_.StatusCode, responseText, headers_, responseObject);
{%         endif -%}
{%     else -%}
({{ response.Type }} responseObject, String responseText) = await this.ReadObjectResponseAsync<{{ response.Type }}>( response_, headers_ ).ConfigureAwait(false);
{%         if response.IsSuccess -%}
{%             if operation.WrapResponse -%}
return new {{ ResponseClass }}<{{ operation.UnwrappedResultType }}>((Int32)response_.StatusCode, headers_, responseText); 
{%             else -%}
return responseObject; 
{%             endif -%}
{%         endif -%}
{%         if response.IsSuccess == false -%}
{%             if response.InheritsExceptionSchema -%}
if (result_ == null)
    result_ = new {{ response.Type }}();
result_.Data.Add("HttpStatus", status_);
result_.Data.Add("HttpHeaders", headers_);
result_.Data.Add("HttpResponse", responseText);
{%                 if WrapDtoExceptions -%}
throw new ResponseDeserializationException<{{ response.Type }}>("{{ response.ExceptionDescription }}", reason: ClientExceptionReason.ExpectedError, (Int32)response_.StatusCode, responseText, headers_, responseObject);
{%                 else -%}
throw result_;
{%                 endif -%}
{%             else -%}
throw new ResponseDeserializationException<{{ response.Type }}>("{{ response.ExceptionDescription }}", reason: ClientExceptionReason.ExpectedError, (Int32)response_.StatusCode, responseText, headers_, responseObject);
{%             endif -%}
{%         endif -%}
{%     endif -%}
{% elseif response.IsSuccess -%}
{%     if operation.HasResultType -%}
{%         if operation.WrapResponse -%}
return new {{ ResponseClass }}<{{ operation.UnwrappedResultType }}>((Int32)response_.StatusCode, headers_, default({{ operation.UnwrappedResultType }})); 
{%         else -%}
return default({{ operation.UnwrappedResultType }});
{%         endif -%}
{%     else -%}
{%         if operation.WrapResponse -%}
return new {{ ResponseClass }}((Int32)response_.StatusCode, headers_); 
{%         else -%}
return;
{%         endif -%}
{%     endif -%}
{% else -%}{% comment %} implied: `if !response.HasType` so just read it as text {% endcomment %}
String responseText = ( response_.Content == null ) ? null : await response_.Content.ReadAsStringAsync().ConfigureAwait(false);
throw new ResponseDeserializationException("{{ response.ExceptionDescription }}", reason: ClientExceptionReason.ExpectedError, (Int32)response_.StatusCode, responseText, headers_, null);
{% endif -%}